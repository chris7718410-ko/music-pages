<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>마음이 쉬는 방</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:24px; line-height:1.4}
    h1{margin:0 0 14px}
    .tabs{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 16px}
    .tab{padding:10px 14px; border:1px solid #ccc; border-radius:10px; cursor:pointer; background:#f7f7f7}
    .tab.active{background:#111; color:#fff; border-color:#111}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:12px 0}
    select, button{padding:10px 12px; border-radius:10px; border:1px solid #ccc; font-size:16px}
    button{cursor:pointer}
    .box{border:1px solid #e1e1e1; border-radius:14px; padding:14px; max-width:760px}
    .hint{font-size:14px; color:#555; margin-top:8px}
    audio{width:100%; margin-top:10px}
    .small{font-size:13px; color:#777}
  </style>
</head>
<body>
  <h1>마음이 쉬는 방</h1>
  <div class="small">방을 선택하면 목록이 뜨고, 재생 후 끝나면 다음 곡으로 자동 넘어갑니다.</div>

  <div class="tabs">
    <div class="tab active" data-room="cry">Cry</div>
    <div class="tab" data-room="rest">Rest</div>
    <div class="tab" data-room="angry">Angry</div>
  </div>

  <div class="box">
    <div class="row">
      <label for="trackSelect"><b>곡 선택</b></label>
      <select id="trackSelect"></select>
      <button id="playBtn">재생</button>
      <button id="nextBtn">다음</button>
    </div>

    <div id="now" class="hint"></div>
    <audio id="player" controls preload="metadata"></audio>
    <div class="hint" id="status"></div>
  </div>

<script>
/**
 * ✅ 중요
 * 1) 아래 배열에 각 폴더의 mp3 파일명을 "정확히" 넣어야 합니다.
 * 2) 파일명이 한글/공백이면 가능은 하지만, 오류가 나기 쉬워서
 *    가능하면 영문/숫자/언더바 권장.
 */
const ROOMS = {
  cry:   { title: "Cry",   files: [] },
  rest:  { title: "Rest",  files: [] },
  angry: { title: "Angry", files: [] },
};

// ✅ 여기만 채우면 끝 (예시 지우고 본인 파일명으로)
// ROOMS.cry.files   = ["01.mp3","02.mp3"];
// ROOMS.rest.files  = ["a.mp3","b.mp3"];
// ROOMS.angry.files = ["x.mp3","y.mp3"];

// ------------------- 동작 코드 -------------------
let currentRoom = "cry";
let currentIndex = 0;

const player = document.getElementById("player");
const select = document.getElementById("trackSelect");
const nowEl = document.getElementById("now");
const statusEl = document.getElementById("status");

function buildSelect() {
  select.innerHTML = "";
  const list = ROOMS[currentRoom].files;
  if (!list || list.length === 0) {
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "※ 이 방의 파일명이 아직 입력되지 않았습니다.";
    select.appendChild(opt);
    statusEl.textContent = "위 코드에서 ROOMS."+currentRoom+".files 배열에 mp3 파일명을 넣어주세요.";
    player.removeAttribute("src");
    nowEl.textContent = "";
    return;
  }
  list.forEach((f, idx) => {
    const opt = document.createElement("option");
    opt.value = idx;
    opt.textContent = `${idx+1}. ${f}`;
    select.appendChild(opt);
  });
  statusEl.textContent = "";
  select.value = String(currentIndex);
  loadCurrent(false);
}

function fileUrl(room, filename){
  // GitHub Pages 주소 기준: /music-pages/폴더명/파일명
  return `${location.origin}/music-pages/${room}/${encodeURIComponent(filename)}`;
}

function loadCurrent(autoplay=true){
  const list = ROOMS[currentRoom].files;
  if (!list || list.length === 0) return;

  const filename = list[currentIndex];
  const url = fileUrl(currentRoom, filename);

  player.src = url;
  nowEl.innerHTML = `<b>${ROOMS[currentRoom].title}</b> · ${filename}`;
  if (autoplay) player.play().catch(()=>{});
}

function nextTrack(){
  const list = ROOMS[currentRoom].files;
  if (!list || list.length === 0) return;

  currentIndex = (currentIndex + 1) % list.length;
  select.value = String(currentIndex);
  loadCurrent(true);
}

document.getElementById("playBtn").addEventListener("click", () => {
  if (!player.src) loadCurrent(true);
  else player.play().catch(()=>{});
});

document.getElementById("nextBtn").addEventListener("click", nextTrack);

select.addEventListener("change", () => {
  currentIndex = Number(select.value || 0);
  loadCurrent(true);
});

player.addEventListener("ended", nextTrack);

document.querySelectorAll(".tab").forEach(t => {
  t.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    currentRoom = t.dataset.room;
    currentIndex = 0;
    buildSelect();
  });
});

// 초기
buildSelect();
</script>
</body>
</html>
